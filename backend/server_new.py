"""
NotesHub API - Main Application
Modular FastAPI application with organized routers
"""\n\nfrom fastapi import FastAPI\nfrom fastapi.middleware.cors import CORSMiddleware\nfrom slowapi import Limiter, _rate_limit_exceeded_handler\nfrom slowapi.util import get_remote_address\nfrom slowapi.errors import RateLimitExceeded\nfrom contextlib import asynccontextmanager\nimport os\n\nfrom database import db\n\n# Import routers\nfrom routers import health, auth, notes, users\n\n\n# Lifespan context manager for startup and shutdown\n@asynccontextmanager\nasync def lifespan(app: FastAPI):\n    """Manage application lifecycle"""\n    # Startup\n    print("üöÄ Starting NotesHub API...")\n    await db.connect_to_database()\n    \n    # Create upload directories\n    os.makedirs("uploads/notes", exist_ok=True)\n    os.makedirs("uploads/profile", exist_ok=True)\n    \n    print("‚úÖ NotesHub API started successfully!")\n    \n    yield\n    \n    # Shutdown\n    print("üõë Shutting down NotesHub API...")\n    await db.close_database_connection()\n    print("‚úÖ Database connections closed")\n\n\n# Initialize FastAPI app\napp = FastAPI(\n    title="NotesHub API",\n    version="1.0.0",\n    description="A collaborative note-sharing platform for students",\n    lifespan=lifespan\n)\n\n# Rate limiter configuration\nlimiter = Limiter(key_func=get_remote_address)\napp.state.limiter = limiter\napp.add_exception_handler(RateLimitExceeded, _rate_limit_exceeded_handler)\n\n# CORS configuration\n# Get allowed origins from environment or use default\nALLOWED_ORIGINS = os.getenv(\n    'ALLOWED_ORIGINS',\n    'http://localhost:3000,http://localhost:5173'\n).split(',')\n\napp.add_middleware(\n    CORSMiddleware,\n    allow_origins=ALLOWED_ORIGINS,  # Configured via environment\n    allow_credentials=True,\n    allow_methods=["*"],\n    allow_headers=["*"],\n)\n\n# Include routers\napp.include_router(health.router)\napp.include_router(auth.router)\napp.include_router(notes.router)\napp.include_router(users.router)\n\n\n# Global exception handler\n@app.exception_handler(Exception)\nasync def global_exception_handler(request, exc):\n    """Handle uncaught exceptions"""\n    print(f"‚ùå Unhandled exception: {exc}")\n    return {"error": "Internal server error", "detail": str(exc)}\n\n\nif __name__ == "__main__":\n    import uvicorn\n    uvicorn.run(app, host="0.0.0.0", port=8001)\n
